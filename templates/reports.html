{% extends 'base.html' %}
{% block content %}
  <h2>Reports</h2>

  <h4>Daily Sales ({{today}})</h4>
  <p><strong>Total today:</strong> {{'%.2f'|format(total_daily)}}</p>
  <table class="table table-sm">
    <thead><tr><th>ID</th><th>Medicine</th><th>Qty</th><th>Total</th><th>Time</th></tr></thead>
    <tbody>
      {% for s in daily_sales %}
        <tr><td>{{s.id}}</td><td>{{s.medicine.name}}</td><td>{{s.quantity}}</td><td>{{'%.2f'|format(s.total_price)}}</td><td>{{s.timestamp}}</td></tr>
      {% endfor %}
    </tbody>
  </table>

  <h4>All-time Sales Summary</h4>
  <p><strong>Total all time:</strong> {{'%.2f'|format(total_all)}}</p>

  <h4>Reset Sales Data</h4>
  <form action="{{ url_for('reset_confirm') }}" method="post">
    <input type="hidden" name="csrf_token" value="{{ generate_csrf() }}">
    <div class="mb-3">
      <label class="form-label">Select Reset Period:</label>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="period" id="daily" value="daily" required>
        <label class="form-check-label" for="daily">
          Daily (delete sales older than 24 hours)
        </label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="period" id="monthly" value="monthly">
        <label class="form-check-label" for="monthly">
          Monthly (delete sales older than 30 days)
        </label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="period" id="half_yearly" value="half_yearly">
        <label class="form-check-label" for="half_yearly">
          Half-yearly (delete sales older than 180 days)
        </label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="period" id="yearly" value="yearly">
        <label class="form-check-label" for="yearly">
          Yearly (delete sales older than 365 days)
        </label>
      </div>
    </div>
    <button type="submit" class="btn btn-warning">Proceed to Confirm Reset</button>
  </form>

  <h4>Stock Report</h4>
  <table class="table table-striped">
    <thead><tr><th>Medicine</th><th>Qty</th><th>Expiry</th><th>Notes</th></tr></thead>
    <tbody>
      {% for m in medicines %}
        <tr>
          <td>{{m.name}}</td>
          <td>{{m.quantity}}</td>
          <td>{{m.expiry_date or 'â€”'}}</td>
          <td>
            {% if m.quantity <= 5 %}<span class="badge bg-warning text-dark">Low</span>{% endif %}
            {% if m.expiry_date and m.expiry_date < today %}<span class="badge bg-danger">Expired</span>{% elif m.near_expiry() %}<span class="badge bg-warning text-dark">Near expiry</span>{% endif %}
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

{% endblock %}
